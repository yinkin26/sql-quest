<!DOCTYPE html>
<html lang="en" class="pixel-art dark-theme">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Quest - SQL GROUP BY</title>
    <link rel="stylesheet" href="stylesheets/style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <script src="javascripts/loadComponents.js" defer></script>
    <script src="javascripts/script.js" defer></script>
    <script src="javascripts/lessonTracker.js" defer></script>
</head>
<body class="pixel-art dark-theme">
    <div id="header"></div>
    <div class="lesson-layout">
        <section class="lesson-content">
            <h1>üóÇÔ∏è SQL GROUP BY</h1>
            
            <h3>ü§î What is GROUP BY?</h3>
            <p>The <strong>GROUP BY</strong> clause is one of the most powerful features in SQL that allows you to organize rows into groups based on one or more columns. It's essential for data analysis, reporting, and business intelligence.</p>
            
            <p><strong>GROUP BY is used to:</strong></p>
            <ul>
                <li><strong>Aggregate Data</strong>: Combine multiple rows into summary information</li>
                <li><strong>Create Reports</strong>: Generate business reports with totals, averages, and counts</li>
                <li><strong>Analyze Patterns</strong>: Identify trends and patterns in your data</li>
                <li><strong>Segment Data</strong>: Break down data by categories, regions, time periods, etc.</li>
                <li><strong>Calculate Metrics</strong>: Compute KPIs and performance indicators</li>
            </ul>
            
            <p><strong>How GROUP BY Works:</strong></p>
            <p>When you use GROUP BY, SQL takes all the rows in your table and organizes them into groups where all rows in each group have the same values for the specified column(s). Then, aggregate functions like COUNT, SUM, AVG, MIN, and MAX are applied to each group separately.</p>
            
            <h3>üìù Basic Syntax</h3>
            <div class="code-block">
                <pre><code>SELECT column1, aggregate_function(column2)
FROM table_name
WHERE condition
GROUP BY column1
HAVING group_condition
ORDER BY column1;</code></pre>
            </div>
            
            <p><strong>Key Components:</strong></p>
            <ul>
                <li><strong>SELECT</strong>: Must include grouped columns and aggregate functions</li>
                <li><strong>GROUP BY</strong>: Specifies which columns to group by</li>
                <li><strong>WHERE</strong>: Filters rows before grouping (optional)</li>
                <li><strong>HAVING</strong>: Filters groups after grouping (optional)</li>
                <li><strong>ORDER BY</strong>: Sorts the final results (optional)</li>
            </ul>
            
            <p><strong>Example with GROUP BY:</strong></p>
            <div class="code-block">
                <pre><code>-- Count orders per customer
SELECT customer_id, COUNT(*) as order_count
FROM orders
GROUP BY customer_id
ORDER BY order_count DESC;</code></pre>
            </div>
            
            <h3>üîß Try It Yourself</h3>
            <div class="editor-container">
                <textarea class="code-editor" id="sqlEditor" placeholder="Write your GROUP BY query here..."></textarea>
                <button class="neon-button" onclick="executeQuery()">Execute Query</button>
                <div id="queryResult" style="margin-top: 15px;"></div>
            </div>
            
            <h3>üí° Examples</h3>
            
            <h4>1. Sales Analysis by Region</h4>
            <div class="code-block">
                <pre><code>-- Total sales and average order value by region
SELECT 
    region,
    COUNT(*) as total_orders,
    SUM(order_amount) as total_sales,
    AVG(order_amount) as avg_order_value,
    MIN(order_amount) as min_order,
    MAX(order_amount) as max_order
FROM sales
WHERE order_date >= '2024-01-01'
GROUP BY region
HAVING total_sales > 10000
ORDER BY total_sales DESC;</code></pre>
            </div>
            
            <h4>2. Monthly Sales Trends</h4>
            <div class="code-block">
                <pre><code>-- Monthly sales performance
SELECT 
    YEAR(order_date) as year,
    MONTH(order_date) as month,
    COUNT(*) as orders_count,
    SUM(amount) as monthly_revenue,
    AVG(amount) as avg_order_value
FROM orders
GROUP BY YEAR(order_date), MONTH(order_date)
ORDER BY year DESC, month DESC;</code></pre>
            </div>
            
            <h4>3. Customer Segmentation</h4>
            <div class="code-block">
                <pre><code>-- Segment customers by purchase behavior
SELECT 
    CASE 
        WHEN total_spent >= 1000 THEN 'Premium'
        WHEN total_spent >= 500 THEN 'Regular'
        ELSE 'Basic'
    END as customer_segment,
    COUNT(*) as customer_count,
    AVG(total_spent) as avg_spending
FROM (
    SELECT 
        customer_id,
        SUM(order_amount) as total_spent
    FROM orders
    GROUP BY customer_id
) customer_totals
GROUP BY customer_segment
ORDER BY avg_spending DESC;</code></pre>
            </div>
            
            <h4>4. Department Performance Analysis</h4>
            <div class="code-block">
                <pre><code>-- Employee performance by department
SELECT 
    department,
    COUNT(*) as employee_count,
    AVG(salary) as avg_salary,
    SUM(salary) as total_payroll,
    MIN(hire_date) as earliest_hire,
    MAX(hire_date) as latest_hire
FROM employees
WHERE status = 'Active'
GROUP BY department
HAVING employee_count >= 5
ORDER BY avg_salary DESC;</code></pre>
            </div>
            
            <h4>5. Product Performance by Category</h4>
            <div class="code-block">
                <pre><code>-- Multi-level grouping: Category and Subcategory
SELECT 
    category,
    subcategory,
    COUNT(*) as product_count,
    AVG(price) as avg_price,
    SUM(units_sold) as total_units_sold,
    SUM(price * units_sold) as total_revenue
FROM products p
JOIN sales s ON p.product_id = s.product_id
GROUP BY category, subcategory
HAVING total_revenue > 5000
ORDER BY category, total_revenue DESC;</code></pre>
            </div>
            
            <h3>üí° Helpful Tips</h3>
            <ul>
                <li><strong>SELECT Rule</strong>: Every column in SELECT must either be in GROUP BY or be an aggregate function</li>
                <li><strong>NULL Handling</strong>: NULL values are grouped together as a single group</li>
                <li><strong>Performance</strong>: Add indexes on columns used in GROUP BY for better performance</li>
                <li><strong>Multiple Columns</strong>: You can group by multiple columns: GROUP BY col1, col2, col3</li>
                <li><strong>Expression Grouping</strong>: You can group by expressions: GROUP BY YEAR(date), MONTH(date)</li>
                <li><strong>HAVING vs WHERE</strong>: Use WHERE to filter before grouping, HAVING to filter after grouping</li>
                <li><strong>Order Matters</strong>: SQL execution order: FROM ‚Üí WHERE ‚Üí GROUP BY ‚Üí HAVING ‚Üí SELECT ‚Üí ORDER BY</li>
                <li><strong>Aggregate Functions</strong>: Common ones include COUNT(), SUM(), AVG(), MIN(), MAX(), COUNT(DISTINCT)</li>
                <li><strong>DISTINCT Alternative</strong>: GROUP BY can sometimes replace DISTINCT for unique value queries</li>
                <li><strong>Subqueries</strong>: Use subqueries with GROUP BY for complex analysis and multi-level aggregations</li>
            </ul>
            
            <h3>üß† Summary</h3>
            <ul>
                <li><strong>Purpose</strong>: GROUP BY organizes data into meaningful categories for analysis</li>
                <li><strong>Power</strong>: Enables complex business intelligence and reporting queries</li>
                <li><strong>Flexibility</strong>: Works with multiple columns, expressions, and conditional logic</li>
                <li><strong>Best Practice</strong>: Combine with aggregate functions, WHERE, HAVING, and ORDER BY for comprehensive analysis</li>
            </ul>
            
            <h3>üß™ Practice: Count Orders Per Customer</h3>
            <p>Write a query to count the number of orders for each <code>customer_id</code> in the <code>orders</code> table.</p>
            <div class="editor-container">
                <textarea class="code-editor" id="exerciseInput" placeholder="Write your GROUP BY query here..."></textarea>
                <button class="neon-button" onclick="validateGroupByQuery()">Submit</button>
                <div id="exerciseFeedback" style="margin-top: 15px;"></div>
            </div>
            
            <div class="mock-table" id="mockTable" style="display: none;">
                <h4>Preview: What the table would look like when queried:</h4>
                <h5>After Query (Example Result):</h5>
                <table>
                    <thead>
                        <tr>
                            <th>customer_id</th>
                            <th>order_count</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>101</td>
                            <td>15</td>
                        </tr>
                        <tr>
                            <td>205</td>
                            <td>12</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <h3>üéØ Quiz</h3>
            <p><strong>Which clause is used to group rows in SQL?</strong></p>
            <div class="quiz">
                <button onclick="checkAnswer(this, true)">A) GROUP BY</button>
                <button onclick="checkAnswer(this, false)">B) ORDER BY</button>
                <button onclick="checkAnswer(this, false)">C) WHERE</button>
                <button onclick="checkAnswer(this, false)">D) HAVING</button>
                <p class="quiz-feedback"></p>
                <div id="quizExplanation" class="quiz-explanation" style="display: none;"></div>
            </div>
        </section>
    </div>
    <div id="footer"></div>
</body>
</html>